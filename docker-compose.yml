version: "3"

networks:
  internet:
    external: true
  proxy-untrusted:
    external: true
  kvm_net:
    name: kvm_net

services:
  webvirtcloud:
    image: "muratovas/webvirtcloud"
    container_name: webvirtcloud
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - /var/run/libvirt/:/var/run/libvirt/
      - /dev/pts/:/dev/pts/
      - ./data/:/srv/webvirtcloud/data/
      - ./ssh/:/var/www/.ssh
      #- ./webvirtcloud/:/srv/webvirtcloud/webvirtcloud
    environment:
      KVM_HOST: "172.24.0.1"
    networks:
      internet:
        ipv4_address: 172.24.0.200
      proxy-untrusted:
      kvm_net:

  nginx:
    image: weejewel/nginx-with-certbot
    container_name: nginx
    restart: unless-stopped
    ports:
      #- "80:80"
      - "443:443"
    networks:
      - internet
      - proxy-untrusted
    volumes:
      #- ./nginx/servers/:/etc/nginx/servers/
      #- ./nginx/auth/:/etc/nginx/auth/
      - ./nginx/.htpasswd:/etc/nginx/auth/.htpasswd
      - ./nginx/servers.conf:/etc/nginx/servers/servers.conf
      - ./nginx/certificate/:/etc/nginx/certificate
      - ./nginx/letsencrypt/:/etc/letsencrypt/
